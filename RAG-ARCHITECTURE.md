# RAG æ¶æ„æ–‡æ¡£

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·å±‚ (User Layer)                         â”‚
â”‚                                                                       â”‚
â”‚  ç”¨æˆ·æé—® â”€â”€â†’ Agent.chat(question)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Agent å±‚ (Agent Layer)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Agent Class                                                 â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  chat(userMessage) {                                        â”‚   â”‚
â”‚  â”‚    1. if (enableRAG) {                                      â”‚   â”‚
â”‚  â”‚         context = ragRetriever.retrieveContext(message)     â”‚   â”‚
â”‚  â”‚         enhancedMessage = context + userMessage             â”‚   â”‚
â”‚  â”‚       }                                                      â”‚   â”‚
â”‚  â”‚    2. response = chatModel.chat(enhancedMessage)           â”‚   â”‚
â”‚  â”‚    3. return response                                       â”‚   â”‚
â”‚  â”‚  }                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RAG å±‚ (RAG Layer)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RAGRetriever                                                â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  retrieveContext(query, topK) {                             â”‚   â”‚
â”‚  â”‚    1. queryVector = embeddingModel.embedText(query)        â”‚   â”‚
â”‚  â”‚    2. results = vectorStore.retrieve(queryVector, topK)    â”‚   â”‚
â”‚  â”‚    3. context = formatResults(results)                     â”‚   â”‚
â”‚  â”‚    4. return context                                        â”‚   â”‚
â”‚  â”‚  }                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                 â”‚                   â”‚                 â”‚
    â–¼                 â–¼                   â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Embedding â”‚   â”‚   Vector   â”‚   â”‚   Document   â”‚   â”‚    Types     â”‚
â”‚  Model   â”‚   â”‚   Store    â”‚   â”‚  Processor   â”‚   â”‚  & Utils     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚                  â”‚
     â–¼               â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å­˜å‚¨å±‚ (Storage Layer)                             â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   å†…å­˜å­˜å‚¨    â”‚  â”‚  JSON æ–‡ä»¶    â”‚  â”‚  æ–‡æ¡£æ–‡ä»¶     â”‚             â”‚
â”‚  â”‚   (Vectors)   â”‚  â”‚  (æŒä¹…åŒ–)     â”‚  â”‚  (.md/.txt)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ¨¡å—è¯¦ç»†è®¾è®¡

### 1. RAGRetrieverï¼ˆæ ¸å¿ƒåè°ƒå™¨ï¼‰

```
RAGRetriever
â”œâ”€â”€ embeddingModel: EmbeddingModel      # å‘é‡åŒ–å¼•æ“
â”œâ”€â”€ vectorStore: VectorStore            # å‘é‡å­˜å‚¨
â”œâ”€â”€ documentProcessor: DocumentProcessor # æ–‡æ¡£å¤„ç†å™¨
â”œâ”€â”€ topK: number                        # æ£€ç´¢æ•°é‡
â”‚
â”œâ”€â”€ indexDocuments(path, options)       # ç´¢å¼•æ–‡æ¡£
â”‚   â”œâ”€â†’ documentProcessor.loadDocuments()
â”‚   â”œâ”€â†’ documentProcessor.splitDocuments()
â”‚   â””â”€â†’ vectorStore.addDocuments()
â”‚
â”œâ”€â”€ retrieve(query, topK)               # æ£€ç´¢æ–‡æ¡£
â”‚   â”œâ”€â†’ embeddingModel.embedText()
â”‚   â””â”€â†’ vectorStore.retrieve()
â”‚
â”œâ”€â”€ retrieveContext(query, topK)        # æ£€ç´¢å¹¶æ ¼å¼åŒ–
â”‚   â”œâ”€â†’ retrieve()
â”‚   â””â”€â†’ formatResults()
â”‚
â”œâ”€â”€ save(filePath)                      # ä¿å­˜
â”‚   â””â”€â†’ vectorStore.save()
â”‚
â””â”€â”€ load(filePath)                      # åŠ è½½
    â””â”€â†’ vectorStore.load()
```

### 2. EmbeddingModelï¼ˆå‘é‡åŒ–å¼•æ“ï¼‰

```
EmbeddingModel
â”œâ”€â”€ client: OpenAI                      # OpenAI å®¢æˆ·ç«¯
â”œâ”€â”€ model: string                       # åµŒå…¥æ¨¡å‹åç§°
â”‚
â”œâ”€â”€ embedText(text): Promise<number[]>  # å•æ–‡æœ¬å‘é‡åŒ–
â”‚   â””â”€â†’ openai.embeddings.create()
â”‚
â”œâ”€â”€ embedBatch(texts): Promise<number[][]> # æ‰¹é‡å‘é‡åŒ–
â”‚   â””â”€â†’ openai.embeddings.create()
â”‚
â””â”€â”€ static cosineSimilarity(a, b): number # ç›¸ä¼¼åº¦è®¡ç®—
    â””â”€â†’ dot(a, b) / (norm(a) * norm(b))
```

### 3. VectorStoreï¼ˆå‘é‡å­˜å‚¨ï¼‰

```
VectorStore
â”œâ”€â”€ documents: VectorDocument[]         # å†…å­˜å­˜å‚¨
â”œâ”€â”€ embeddingModel: EmbeddingModel     # å‘é‡åŒ–å¼•æ“
â”‚
â”œâ”€â”€ addDocuments(docs)                  # æ·»åŠ æ–‡æ¡£
â”‚   â”œâ”€â†’ embeddingModel.embedBatch()
â”‚   â””â”€â†’ documents.push()
â”‚
â”œâ”€â”€ retrieve(query, topK)               # æ£€ç´¢
â”‚   â”œâ”€â†’ embeddingModel.embedText()
â”‚   â”œâ”€â†’ documents.map(calculateSimilarity)
â”‚   â”œâ”€â†’ sort(byScore)
â”‚   â””â”€â†’ slice(0, topK)
â”‚
â”œâ”€â”€ save(filePath)                      # ä¿å­˜åˆ° JSON
â”‚   â””â”€â†’ fs.writeFileSync()
â”‚
â””â”€â”€ load(filePath)                      # ä» JSON åŠ è½½
    â””â”€â†’ fs.readFileSync()
```

### 4. DocumentProcessorï¼ˆæ–‡æ¡£å¤„ç†å™¨ï¼‰

```
DocumentProcessor
â”œâ”€â”€ chunkSize: number                   # åˆ†å—å¤§å°
â”œâ”€â”€ chunkOverlap: number               # é‡å å¤§å°
â”‚
â”œâ”€â”€ loadDocuments(path, options)        # åŠ è½½æ–‡æ¡£
â”‚   â”œâ”€â†’ getFiles(recursive, extensions)
â”‚   â””â”€â†’ loadFile()
â”‚
â”œâ”€â”€ splitDocuments(docs)                # æ–‡æ¡£åˆ†å—
â”‚   â”œâ”€â†’ splitText()
â”‚   â””â”€â†’ generateMetadata()
â”‚
â””â”€â”€ private methods:
    â”œâ”€â”€ splitText()                     # æ–‡æœ¬åˆ†å‰²
    â”œâ”€â”€ findSentenceEnd()              # å¥å­è¾¹ç•Œ
    â””â”€â”€ generateId()                    # ç”Ÿæˆ ID
```

## ğŸ”„ æ•°æ®æµå›¾

### æ–‡æ¡£ç´¢å¼•æµç¨‹

```
æ–‡æ¡£æ–‡ä»¶ (.md, .txt, .json)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DocumentProcessor   â”‚
â”‚ loadDocuments()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Document[]
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DocumentProcessor   â”‚
â”‚ splitDocuments()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Document[] (chunks)
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmbeddingModel      â”‚
â”‚ embedBatch()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ number[][]
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VectorStore         â”‚
â”‚ addDocuments()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    å†…å­˜å‘é‡å­˜å‚¨
```

### æŸ¥è¯¢æ£€ç´¢æµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢ (string)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmbeddingModel      â”‚
â”‚ embedText()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ number[]
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VectorStore         â”‚
â”‚ retrieve()          â”‚
â”‚ - è®¡ç®—ç›¸ä¼¼åº¦         â”‚
â”‚ - æ’åº               â”‚
â”‚ - Top-K é€‰æ‹©         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ RetrievalResult[]
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RAGRetriever        â”‚
â”‚ formatResults()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ string (context)
          â–¼
    æ³¨å…¥åˆ° Prompt
```

### Agent é›†æˆæµç¨‹

```
userMessage
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent.chat()                â”‚
â”‚ if (enableRAG) {            â”‚
â”‚   step 1: æ£€ç´¢ç›¸å…³æ–‡æ¡£      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RAGRetriever                â”‚
â”‚ retrieveContext()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ context
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent.chat()                â”‚
â”‚   step 2: æ„é€ å¢å¼ºæ¶ˆæ¯      â”‚
â”‚   enhancedMessage =         â”‚
â”‚     context + userMessage   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatOpenAI                  â”‚
â”‚   step 3: è°ƒç”¨å¤§æ¨¡å‹        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    åŠ©æ‰‹å›ç­”
```

## ğŸ—‚ï¸ æ•°æ®ç»“æ„

### Document æ¥å£

```typescript
interface Document {
    id: string;                  // å”¯ä¸€æ ‡è¯†
    content: string;             // æ–‡æ¡£å†…å®¹
    metadata: {
        source: string;          // æ¥æºæ–‡ä»¶è·¯å¾„
        timestamp: number;       // æ—¶é—´æˆ³
        chunkIndex?: number;     // åˆ†å—ç´¢å¼•
        totalChunks?: number;    // æ€»åˆ†å—æ•°
        [key: string]: any;      // è‡ªå®šä¹‰å…ƒæ•°æ®
    };
}
```

### VectorDocument æ¥å£

```typescript
interface VectorDocument extends Document {
    embedding: number[];         // å‘é‡è¡¨ç¤ºï¼ˆ1536 ç»´ï¼‰
}
```

### RetrievalResult æ¥å£

```typescript
interface RetrievalResult {
    document: Document;          // æ£€ç´¢åˆ°çš„æ–‡æ¡£
    score: number;               // ç›¸ä¼¼åº¦åˆ†æ•° [0, 1]
}
```

## ğŸ§® æ ¸å¿ƒç®—æ³•

### 1. æ–‡æ¡£åˆ†å—ç®—æ³•

```
è¾“å…¥: text, chunkSize=1000, chunkOverlap=200
è¾“å‡º: chunks[]

ç®—æ³•:
1. å¦‚æœ text.length <= chunkSize:
     è¿”å› [text]

2. åˆå§‹åŒ– chunks = [], start = 0

3. while start < text.length:
     end = start + chunkSize
     
     å¦‚æœ end < text.length:
         # å¯»æ‰¾å¥å­è¾¹ç•Œ
         sentenceEnd = findSentenceEnd(text, end)
         if sentenceEnd > start:
             end = sentenceEnd
     
     chunks.push(text.slice(start, end))
     
     # æ»‘åŠ¨çª—å£ï¼ˆè€ƒè™‘é‡å ï¼‰
     start = end - chunkOverlap

4. è¿”å› chunks
```

### 2. ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•

```
è¾“å…¥: vectorA[n], vectorB[n]
è¾“å‡º: similarity âˆˆ [0, 1]

ç®—æ³•:
1. dotProduct = Î£(A[i] * B[i])
2. normA = sqrt(Î£(A[i]Â²))
3. normB = sqrt(Î£(B[i]Â²))
4. similarity = dotProduct / (normA * normB)

æ€§è´¨:
- similarity = 1: å®Œå…¨ç›¸åŒ
- similarity = 0: æ­£äº¤ï¼ˆæ— å…³ï¼‰
- similarity = -1: å®Œå…¨ç›¸å
```

### 3. Top-K æ£€ç´¢ç®—æ³•

```
è¾“å…¥: query, documents[], k
è¾“å‡º: topK RetrievalResult[]

ç®—æ³•:
1. queryVector = embedText(query)

2. results = []
   for each doc in documents:
       score = cosineSimilarity(queryVector, doc.embedding)
       results.push({ document: doc, score })

3. results.sort((a, b) => b.score - a.score)

4. return results.slice(0, k)

æ—¶é—´å¤æ‚åº¦: O(n log n), n = documents.length
ç©ºé—´å¤æ‚åº¦: O(n)
```

## ğŸ“ˆ æ€§èƒ½ç‰¹å¾

### æ—¶é—´å¤æ‚åº¦

| æ“ä½œ | å¤æ‚åº¦ | è¯´æ˜ |
|-----|-------|------|
| å•æ–‡æœ¬å‘é‡åŒ– | O(1) | API è°ƒç”¨ |
| æ‰¹é‡å‘é‡åŒ– | O(n) | n ä¸ªæ–‡æœ¬ |
| æ·»åŠ æ–‡æ¡£ | O(n) | n ä¸ªæ–‡æ¡£ |
| æ£€ç´¢ (Top-K) | O(m + m log m) | m = å­˜å‚¨çš„æ–‡æ¡£æ•° |
| ä¿å­˜/åŠ è½½ | O(m) | JSON åºåˆ—åŒ– |

### ç©ºé—´å¤æ‚åº¦

| ç»„ä»¶ | å¤æ‚åº¦ | è¯´æ˜ |
|-----|-------|------|
| å‘é‡å­˜å‚¨ | O(m Ã— d) | m ä¸ªæ–‡æ¡£ï¼Œd ç»´å‘é‡ (1536) |
| æŒä¹…åŒ–æ–‡ä»¶ | O(m Ã— d) | JSON æ ¼å¼ |

### æ€§èƒ½ä¼˜åŒ–ç‚¹

1. **æ‰¹é‡å‘é‡åŒ–**
   - ä¸€æ¬¡ API è°ƒç”¨å¤„ç†å¤šä¸ªæ–‡æ¡£
   - å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°

2. **å†…å­˜å­˜å‚¨**
   - å¿«é€Ÿæ£€ç´¢ï¼ˆæ— ç£ç›˜ I/Oï¼‰
   - ç›¸ä¼¼åº¦è®¡ç®—åœ¨å†…å­˜ä¸­å®Œæˆ

3. **æŒä¹…åŒ–æœºåˆ¶**
   - é¿å…é‡å¤ç´¢å¼•
   - å¿«é€Ÿå¯åŠ¨

## ğŸ”Œ æ‰©å±•æ¥å£

### è‡ªå®šä¹‰åµŒå…¥æ¨¡å‹

```typescript
interface IEmbeddingModel {
    embedText(text: string): Promise<number[]>;
    embedBatch(texts: string[]): Promise<number[][]>;
}

// ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹
class CustomEmbedding implements IEmbeddingModel {
    async embedText(text: string): Promise<number[]> {
        // è‡ªå®šä¹‰å®ç°
    }
    async embedBatch(texts: string[]): Promise<number[][]> {
        // è‡ªå®šä¹‰å®ç°
    }
}
```

### è‡ªå®šä¹‰å‘é‡å­˜å‚¨

```typescript
interface IVectorStore {
    addDocuments(docs: Document[]): Promise<void>;
    retrieve(query: string, topK: number): Promise<RetrievalResult[]>;
    save(path: string): Promise<void>;
    load(path: string): Promise<void>;
}

// ä½¿ç”¨ä¸“ä¸šæ•°æ®åº“
class ChromaVectorStore implements IVectorStore {
    // å®ç°æ¥å£
}
```

### è‡ªå®šä¹‰æ–‡æ¡£å¤„ç†å™¨

```typescript
interface IDocumentProcessor {
    loadDocuments(path: string, options?: any): Promise<Document[]>;
    splitDocuments(docs: Document[]): Document[];
}

// æ”¯æŒæ›´å¤šæ ¼å¼
class AdvancedProcessor implements IDocumentProcessor {
    // æ”¯æŒ PDF, DOCX ç­‰
}
```

## ğŸ¯ æ€»ç»“

æœ¬æ¶æ„è®¾è®¡å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **æ¨¡å—åŒ–** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»
2. **å¯æ‰©å±•** - æ¥å£åŒ–è®¾è®¡ï¼Œæ˜“äºæ›¿æ¢ç»„ä»¶
3. **é«˜æ€§èƒ½** - æ‰¹é‡å¤„ç†ã€å†…å­˜å­˜å‚¨
4. **æ˜“ç»´æŠ¤** - ç®€æ´çš„ä»£ç ç»“æ„
5. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹

é€‚åˆä½œä¸º RAG ç³»ç»Ÿçš„å­¦ä¹ å‚è€ƒå’Œå¿«é€ŸåŸå‹å¼€å‘åŸºç¡€ã€‚
